var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i;import{j as o,r,L as c,u as d,a as u,S as h,R as m,b as p,c as f}from"./vendor.f9b320db.js";const v="http://localhost:4000",N=o.exports.jsx,b=o.exports.jsxs,g=({user:e,logout:t,onmounted:a,onunmounted:i})=>{const[n,l]=r.exports.useState({nombre:""});return r.exports.useEffect((()=>(a(),e.nombre&&(async()=>{if(""==n.nombre||""==e.com){let t=await fetch(v+"/auth/companies",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:e.com})});if(t.ok){let[e]=await t.json();l(e)}else l({nombre:""})}})(),()=>{i()})),[e]),N(r.exports.Fragment,{children:b("div",{className:"menu",children:[b("div",{className:"header",children:[N("h1",{children:n.nombre}),N("h2",{children:e.nombre})]}),b("div",{className:"button-list menu-list",children:[N(c,{href:"/",children:N("button",{className:"button",children:"Tickets"})}),N(c,{href:"/hduser",children:N("button",{className:"button",children:"Historias de usuario"})})]}),N("div",{className:"footer",children:N("div",{className:"link",onClick:t,children:N("h4",{children:"Salir"})})})]})})},k=({info:e,title:t,where:a,jwt:i,del:n})=>{const[l,s]=d(),[o,u]=r.exports.useState({activos:[],enProceso:[],finalizados:[]}),h=async(e,t,a)=>{let n=["activos","enProceso","finalizados"],l=(n.indexOf(t)+a)%n.length!=-1?(n.indexOf(t)+a)%n.length:n.length-1,s=n[l];(await fetch(v+"/api/ticket",{method:"PUT",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({id:e,estado:s})})).ok&&p()},m=async e=>{let[t,a]=e.dataTransfer.getData("text").split(" ");if(e.target.id!=a&&e.target.id){(await fetch(v+"/api/ticket",{method:"PUT",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({id:t,estado:e.target.id})})).ok&&p()}},p=async()=>{let t=await fetch(v+e,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(t.ok){t=await t.json();let e=[],a=[],i=[];t.map((t=>{switch(t.estado){case"activos":e.push(t);break;case"enProceso":a.push(t);break;case"finalizados":i.push(t)}})),u({activos:e,enProceso:a,finalizados:i})}};r.exports.useEffect((()=>(e&&p(),()=>{})),[e,a,t]);const f=({title:e,tipo:t})=>b("div",{className:t,id:t,onDrop:m,onDragOver:e=>e.preventDefault(),children:[N("h2",{children:e}),o[t].map((e=>b("div",{className:"ticket",draggable:"true",onDragStart:a=>{a.dataTransfer.setData("text/plain",e.id+" "+t)},children:[b("div",{className:"ticket-title",children:[N("h4",{children:e.titulo}),b("h5",{children:["(",e.hdu.titulo,")"]})]}),N("p",{children:e.descripcion}),b("div",{className:"ticket-buttons",children:[N("div",{className:"ticket-button",onClick:()=>{(async e=>{confirm("Esta seguro que desea eliminiar el Ticket")&&(await fetch(v+n,{method:"DELETE",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({id:e})})).ok&&p()})(e.id)},children:N("div",{className:"cancel"})}),N(c,{href:"/edit/ticket/"+e.id,children:N("div",{className:"ticket-button",children:N("div",{className:"edit"})})}),N("div",{className:"ticket-button",onClick:()=>{h(e.id,t,-1)},children:N("div",{className:"arrow"})}),N("div",{className:"ticket-button",onClick:()=>{h(e.id,t,1)},children:N("div",{className:"arrow rigth"})})]})]},e.id)))]});return N(r.exports.Fragment,{children:b("div",{className:"info",children:[N("div",{className:"header",children:N("h1",{children:t})}),b("div",{className:"estados",children:[N(f,{title:"Activos",tipo:"activos"}),N(f,{title:"En proceso",tipo:"enProceso"}),N(f,{title:"Finalizados",tipo:"finalizados"})]}),N("div",{className:"plus-form ",onClick:()=>s("/create/ticket"),children:N("div",{className:"plus"})})]})})},y=({info:e,title:t,jwt:a,edit:i})=>{const[n,l]=d(),[s,o]=r.exports.useState({});r.exports.useEffect((async()=>{if(i&&a){let t=await fetch(v+e+"s",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({_id:i})});if(t.ok){let[e]=await t.json();o(e)}}return()=>{o({})}}),[e]);return b("form",{onSubmit:async t=>{t.preventDefault();let n=t.target.elements.titulo,s=t.target.elements.descripcion,{value:o}=n,{value:r}=s;(await fetch(v+e,{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({id:i,titulo:o,descripcion:r})})).ok&&l("/")},className:"info form-update",children:[b("div",{className:"header",children:[N(c,{href:"/",children:N("div",{className:"cancel-form",children:N("div",{className:"cancel"})})}),N("h1",{children:t})]}),b("div",{className:"button-list form-content",children:[b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Titulo"}),N("textarea",{name:"titulo",className:"input",defaultValue:s.titulo,required:!0})]}),b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Descripcion"}),N("textarea",{name:"descripcion",className:"input",defaultValue:s.descripcion,required:!0})]}),N("button",{className:"button",type:"submit",children:"enviar"})]})]})},w=({info:e,title:o,jwt:u,ticket:h,where:m})=>{const[p,f]=d(),[g,k]=r.exports.useState([]);r.exports.useEffect((()=>(y(),()=>{k([])})),[e]);const y=async()=>{if(e&&(null==m?void 0:m.compa単ia)){let e=await fetch(v+"/api/hdusers",{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify(m)});e.ok&&k(await e.json())}},w=()=>g.map((e=>N("option",{value:e.id,className:"input",children:e.titulo},e.id))),j=()=>h?b(r.exports.Fragment,{children:[b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Estado"}),b("div",{className:"select ",children:[b("select",{className:"input",name:"estado",required:!0,children:[N("option",{value:"activos",className:"input",children:"Activo"}),N("option",{value:"enProceso",className:"input",children:"En proceso"}),N("option",{value:"finalizados",className:"input",children:"Finalizado"})]}),N("i",{})]})]}),b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Historia de usuario"}),b("div",{className:"select ",children:[N("select",{className:"input",name:"hdUsuario",required:!0,children:N(w,{})}),N("i",{})]})]})]}):"";return b("form",{onSubmit:async o=>{o.preventDefault();let r=o.target.elements.titulo,c=o.target.elements.descripcion,d=o.target.elements.estado,p=o.target.elements.hdUsuario,{value:N}=r,{value:b}=c,{value:g}=d||{},{value:k}=p||{},y={titulo:N,descripcion:b,estado:g,hdUsuario:k};var w,j;h||(w=((e,t)=>{for(var a in t||(t={}))n.call(t,a)&&s(e,a,t[a]);if(i)for(var a of i(t))l.call(t,a)&&s(e,a,t[a]);return e})({},y),j={"compa単ia":m.compa単ia},y=t(w,a(j))),(await fetch(v+e,{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify(y)})).ok&&f("/")},className:"info form-update",children:[b("div",{className:"header",children:[N(c,{href:"/",children:N("div",{className:"cancel-form",children:N("div",{className:"cancel"})})}),N("h1",{children:o})]}),b("div",{className:"button-list form-content",children:[b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Titulo"}),N("textarea",{name:"titulo",className:"input",required:!0})]}),b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Descripcion"}),N("textarea",{name:"descripcion",className:"input",required:!0})]}),N(j,{}),N("button",{className:"button",type:"submit",children:"enviar"})]})]})},j=({info:e,title:t,where:a,jwt:i,del:n})=>{const[l,s]=d(),[o,u]=r.exports.useState([]),h=async()=>{let t=await fetch(v+e,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(a)});t.ok&&(t=await t.json(),u(t))};r.exports.useEffect((()=>(e&&h(),()=>{})),[e]);const m=()=>N(r.exports.Fragment,{children:o.map((e=>b("div",{className:"hduser",children:[N("div",{className:"hduser-title",children:N("b",{children:e.titulo})}),N("p",{children:e.descripcion}),b("div",{className:"hduser-buttons",children:[N("div",{onClick:()=>{(async e=>{confirm("Esta seguro que desea eliminiar la Historia de Usuario")&&(await fetch(v+n,{method:"DELETE",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({id:e})})).ok&&h()})(e.id)},className:"hduser-button",children:N("div",{className:"cancel"})}),N(c,{href:"/edit/hdu/"+e.id,children:N("div",{className:"hduser-button",children:N("div",{className:"edit"})})}),N(c,{href:"/tickets/"+e.id+"_"+e.titulo,children:N("div",{className:"hduser-button",children:N("div",{className:"search"})})})]})]},e.id)))});return N(r.exports.Fragment,{children:b("div",{className:"info",children:[N("div",{className:"header",children:N("h1",{children:t})}),N("div",{className:"hdusers",children:N(m,{})}),N("div",{className:"plus-form ",onClick:()=>s("/create/hdu"),children:N("div",{className:"plus"})})]})})},S=({action:e,onmounted:t,onunmounted:a})=>{r.exports.useEffect((()=>(t(),()=>{a()})),[]);return N("form",{onSubmit:async t=>{t.preventDefault();let a=t.target.elements.correo,i=t.target.elements.password,{value:n}=a,{value:l}=i;if(n.length>6&&l.length>4){let t=await fetch(v+"/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({correo:n,password:l})});if(t.ok){let{token:i}=await t.json();await localStorage.setItem("JWT",i),await e({token:i}),a.value=""}else if(401==t.status){let{error:e}=await t.json();alert(e)}}else alert("El correo y/o la contrase単a son demasiado cortos, ingrese datos validos");i.value=""},children:b("div",{className:"button-list",children:[N("div",{className:"header",children:N("h1",{children:"Ingreso"})}),b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Correo electronico"}),N("input",{type:"email",name:"correo",className:"input",placeholder:"ejemplo@gmail.com",required:!0})]}),b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Contrase単a"}),N("input",{type:"password",name:"password",className:"input",placeholder:"secreto",required:!0})]}),N("button",{className:"button",children:"enviar"}),N(c,{href:"/singup",children:N("div",{className:"link",children:N("h4",{children:"No tiene cuenta aun, registrece aqui"})})})]})})},T=({action:e,onmounted:t,onunmounted:a})=>{const[i,n]=r.exports.useState([]);r.exports.useEffect((()=>(l(),t(),()=>{a()})),[]);const l=async()=>{let e=await fetch(v+"/auth/companies",{method:"POST"});e.ok&&n(await e.json())},s=()=>i.map((e=>N("option",{value:e.id,className:"input",children:e.nombre},e.id)));return N("form",{onSubmit:async t=>{t.preventDefault();let a=t.target.elements.correo,i=t.target.elements.nombre,n=t.target.elements.password,l=t.target.elements.passwordVerify,s=t.target.elements.compa単ia,{value:o}=a,{value:r}=i,{value:c}=n,{value:d}=s;if(l.value==c)if(o.length>6&&c.length>4){let t=await fetch(v+"/auth/singup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({correo:o,nombre:r,password:c,"compa単ia":d})});if(t.ok){alert("Registrado correctamente");let{token:i}=await t.json();await localStorage.setItem("JWT",i),await e({token:i}),a.value=""}else if(401==t.status){let{error:e}=await t.json();alert(e)}}else alert("El correo y/o la contrase単a son demasiado cortos, ingrese datos validos");else alert("Las contrase単as no coinciden");l.value="",n.value=""},children:b("div",{className:"button-list",children:[N("div",{className:"header",children:N("h1",{children:"Registro"})}),b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Correo electronico"}),N("input",{type:"email",name:"correo",className:"input",placeholder:"ejemplo@gmail.com",required:!0})]}),b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Nombre"}),N("input",{type:"text",name:"nombre",className:"input",placeholder:"Pepito Perez",required:!0})]}),b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Contrase単a"}),N("input",{type:"password",name:"password",className:"input",placeholder:"secreto",required:!0})]}),b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Repetir Contrase単a"}),N("input",{type:"password",name:"passwordVerify",className:"input",placeholder:"secreto",required:!0})]}),b("div",{className:"input-couple",children:[N("label",{className:"label-input",children:"Compa単ia"}),b("div",{className:"select ",children:[N("select",{className:"input",name:"compa単ia",required:!0,children:N(s,{})}),N("i",{})]})]}),N("button",{className:"button",children:"enviar"}),N(c,{href:"/login",children:N("div",{className:"link",children:N("h4",{children:"Ya tiene una cuenta, ingrese aqui"})})})]})})},x=({useGlass:e})=>{const[t,a]=r.exports.useState({token:null}),[i,n]=r.exports.useState({nombre:"",com:"",id:""}),[l,s]=d(),[o,c]=u("/tickets/:hdUsuario"),[f,x]=u("/edit/ticket/:tickedId"),[O,C]=u("/edit/hdu/:hduId"),[E,P]=e(),z=async()=>{const e=t.token||localStorage.getItem("JWT");if(e){let i=await fetch(v+"/api",{headers:{Authorization:`Bearer ${e}`}});if(i.ok){if(t.token!=e){a({token:e});let{id:t,nombre:l,com:s}=await i.json();n({id:t,nombre:l,com:s})}}else localStorage.removeItem("JWT"),a({token:null})}else"/login"!=l&&"/singup"!=l&&a({token:null})},J=()=>{D()},q=()=>{E(),z()},D=async()=>{localStorage.removeItem("JWT"),a({token:null}),P(),z()};return r.exports.useEffect((async()=>(z(),()=>{a({token:null})})),[l,t,i]),t.token||localStorage.getItem("JWT")?b(r.exports.Fragment,{children:[N(g,{user:i,logout:D,onmounted:E,onunmounted:P}),b(h,{children:[N(m,{path:"/",children:N(k,{info:i.com?"/api/tickets/"+i.com:"",title:"Todos los tickets",where:{},jwt:t.token,del:"/api/ticket"})}),N(m,{path:"/hduser",children:N(j,{info:i.com?"/api/hdusers":"",title:"Historia de usuario",where:{"compa単ia":i.com},jwt:t.token,del:"/api/hduser"})}),N(m,{path:"/tickets/:hdUsuario",children:()=>{var e;let[a,n]=(null==(e=null==c?void 0:c.hdUsuario)?void 0:e.replaceAll("%20"," ").split("_"))||[null,null];return N(k,{info:i.com?"/api/tickets":"",title:n,where:{hdUsuario:a},jwt:t.token,del:"/api/ticket"})}}),N(m,{path:"/edit/ticket/:tickedId",children:N(y,{info:i.com?"/api/ticket":"",title:"Editar ticket",edit:null==x?void 0:x.tickedId,jwt:t.token})}),N(m,{path:"/create/ticket",children:N(w,{info:i.com?"/api/ticket":"",title:"Crear ticket",jwt:t.token,ticket:"true",where:{"compa単ia":i.com}})}),N(m,{path:"/edit/hdu/:hduId",children:N(y,{info:i.com?"/api/hduser":"",title:"Editar Historia de Usuario",edit:null==C?void 0:C.hduId,jwt:t.token})}),N(m,{path:"/create/hdu",children:N(w,{info:i.com?"/api/hduser":"",title:"Crear Historia de Usuario",where:{"compa単ia":i.com},jwt:t.token})}),N(m,{children:N(p,{to:"/"})})]})]}):b(h,{children:[N(m,{path:"/login",children:N(S,{action:a,onmounted:J,onunmounted:q})}),N(m,{path:"/singup",children:N(T,{action:a,onmounted:J,onunmounted:q})}),N(m,{children:N(p,{to:"/login"})})]})},O=()=>{const[e,t]=r.exports.useState(""),a=()=>{t("complete")},i=()=>{t("")};return r.exports.useEffect((()=>()=>{}),[e]),b(r.exports.Fragment,{children:[N("div",{className:"glass "+e,children:N(x,{useGlass:()=>[a,i]})}),N("div",{className:"circle1"}),N("div",{className:"circle2"})]})};f.render(N(r.exports.StrictMode,{children:N(O,{})}),document.getElementById("root"));
